{% load static %}

{% block title %}Аналитика Telegram | TrendWatcher{% endblock %}

{% block content %}



    
        
        
            
                
                    Процент категорий

                

                
                    
                        <canvas id="categoryChart"></canvas>
                    

                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Категория</th>
                                <th>Процент</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for cat, count in category_counts.items %}
                                <tr>
                                    <td>{{ cat }}</td>
                                    <td>{{ count|floatformat:2 }}%</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                

            

        

        
        
        
            
                
                    Динамика типов контента

                

                
                    
                        <canvas id="contentTypeChart"></canvas>
                    

                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Тип контента</th>
                                <th>Количество</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for content_type, count in content_types.items %}
                                <tr>
                                    <td>{{ content_type }}</td>
                                    <td>{{ count }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                

            

        

        
        
        
            
                
                    Количество публикаций

                

                
                    
                        <canvas id="publicationsChart"></canvas>
                    

                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Дата</th>
                                <th>Количество постов</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for date, count in publications_by_day.items %}
                                <tr>
                                    <td>{{ date }}</td>
                                    <td>{{ count }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                

            

        

        
        
        
            
                
                    Динамика VR post по категориям

                

                
                    
                        <canvas id="vrPostChart"></canvas>
                    

                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Дата</th>
                                <th>Категория</th>
                                <th>Средний VRpost</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for date, categories in vr_by_category_day.items %}
                                {% for category, avg_vr in categories.items %}
                                    <tr>
                                        <td>{{ date }}</td>
                                        <td>{{ category }}</td>
                                        <td>{{ avg_vr|floatformat:2 }}</td>
                                    </tr>
                                {% endfor %}
                            {% endfor %}
                        </tbody>
                    </table>
                

            

        

        
        
        
            
                
                    Динамика постов по категориям

                

                
                    
                        <canvas id="categoryPostsChart"></canvas>
                    

                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Дата</th>
                                <th>Категория</th>
                                <th>Количество постов</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for date, categories in posts_by_category_day.items %}
                                {% for category, count in categories.items %}
                                    <tr>
                                        <td>{{ date }}</td>
                                        <td>{{ category }}</td>
                                        <td>{{ count }}</td>
                                    </tr>
                                {% endfor %}
                            {% endfor %}
                        </tbody>
                    </table>
                

            

        

    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Отладка: выведем данные в консоль
        console.log("category_counts:", {{ category_counts|safe }});
        console.log("content_types:", {{ content_types|safe }});
        console.log("publications_by_day:", {{ publications_by_day|safe }});
        console.log("vr_by_category_day:", {{ vr_by_category_day|safe }});
        console.log("posts_by_category_day:", {{ posts_by_category_day|safe }});

        // Данные для графиков
        const categoryData = {
            labels: Object.keys({{ category_counts|safe }}),
            datasets: [{
                label: 'Процент категорий',
                data: Object.values({{ category_counts|safe }}),
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        };

        const contentTypeData = {
            labels: Object.keys({{ content_types|safe }}),
            datasets: [{
                label: 'Количество',
                data: Object.values({{ content_types|safe }}),
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }]
        };

        const publicationsData = {
            labels: Object.keys({{ publications_by_day|safe }}),
            datasets: [{
                label: 'Количество постов',
                data: Object.values({{ publications_by_day|safe }}),
                backgroundColor: 'rgba(255, 159, 64, 0.2)',
                borderColor: 'rgba(255, 159, 64, 1)',
                borderWidth: 1
            }]
        };

        const vrPostData = {
            labels: [],
            datasets: [{
                label: 'Средний VRpost',
                data: [],
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        };
        const vrData = {{ vr_by_category_day|safe }};
        for (let date in vrData) {
            for (let category in vrData[date]) {
                vrPostData.labels.push(`${date} - ${category}`);
                vrPostData.datasets[0].data.push(vrData[date][category]);
            }
        }

        const categoryPostsData = {
            labels: [],
            datasets: [{
                label: 'Количество постов',
                data: [],
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }]
        };
        const postsData = {{ posts_by_category_day|safe }};
        for (let date in postsData) {
            for (let category in postsData[date]) {
                categoryPostsData.labels.push(`${date} - ${category}`);
                categoryPostsData.datasets[0].data.push(postsData[date][category]);
            }
        }

        // Настройка графиков
        new Chart(document.getElementById('categoryChart').getContext('2d'), {
            type: 'pie',
            data: categoryData,
            options: { responsive: true }
        });

        new Chart(document.getElementById('contentTypeChart').getContext('2d'), {
            type: 'bar',
            data: contentTypeData,
            options: { responsive: true }
        });

        new Chart(document.getElementById('publicationsChart').getContext('2d'), {
            type: 'line',
            data: publicationsData,
            options: { responsive: true }
        });

        new Chart(document.getElementById('vrPostChart').getContext('2d'), {
            type: 'bar',
            data: vrPostData,
            options: { responsive: true }
        });

        new Chart(document.getElementById('categoryPostsChart').getContext('2d'), {
            type: 'bar',
            data: categoryPostsData,
            options: { responsive: true }
        });
    </script>

    <style>
        .chart-container {
            position: relative;
            margin: auto;
            height: 400px;
            width: 600px;
        }
        table {
            width: 100%;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #4F81BD;
            color: white;
        }
    </style>

{% endblock %}